[global]
includes = /mu2e/app/users/srsoleti/workDir/Production/CampaignConfig/mdc2020_prolog.cfg
run_number = 1210
njobs = 2000
release = MDC2020
desc = MDC2020r
release_v_i = p
release_v_o = r
db_folder = mdc2020r
db_version = v1_0
db_purpose = perfect

[job_output_4]
addoutput = *.art
declare_metadata = True
metadata_extractor = printJsonSave.sh
add_location = True
add_metadata = file_format=art
hash = 2
hash_alg = sha256

[job_output_5]
addoutput = *.art
declare_metadata = True
metadata_extractor = printJsonSave.sh
add_location = True
add_metadata = file_format=art
hash = 2
hash_alg = sha256

[job_output_6]
addoutput = *.art
declare_metadata = True
metadata_extractor = printJsonSave.sh
add_location = True
add_metadata = file_format=art
hash = 2
hash_alg = sha256

[stage_flateminus_fcl]
global.stage_name = FlateMinus
job_output.dest = https://dbdata0vm.fnal.gov:9443/mu2e_ucondb_prod/app/data/%(db_folder)s/
job_setup.source_3 = $CONDOR_DIR_INPUT/ucondb_auth.sh

job_setup.prescript = samweb list-file-locations --defname=sim.%(submitter)s.MuminusStopsCat.%(release)s%(release_v_i)s.art --schema=root | cut -f1 > inputs.txt
job_setup.prescript_2 = dataset=sim.%(submitter)s.MuminusStopsCat.%(release)s%(release_v_i)s.art
job_setup.prescript_3 = nfiles=`samCountFiles.sh $dataset`
job_setup.prescript_4 = nevts=`samCountEvents.sh $dataset`
job_setup.prescript_5 = let nskip=nevts/nfiles
job_setup.prescript_6 = echo '#include "Production/JobConfig/primary/FlateMinus.fcl"' >> template.fcl
job_setup.prescript_7 = echo 'physics.filters.TargetStopResampler.mu2e.MaxEventsToSkip: '${nskip} >> template.fcl

executable.name = true
executable_2.name = generate_fcl
executable_2.arg_4 = --auxinput=1:physics.filters.TargetStopResampler.fileNames:inputs.txt
executable_2.arg_5 = --events-per-job=4000
executable_2.arg_6 = --run-number=%(run_number)s
executable_2.arg_7 = --njobs=%(njobs)s
executable_2.arg_8 = --embed
executable_2.arg_9 = template.fcl

job_setup.ifdh_art = False

[stage_flateminus]
global.stage_name = FlateMinus

job_output_1.dest = %(logdir_bck)s/%(stage_name)s/%(desc)s/tbz/
job_output_2.addoutput = *.%(stage_name)s.*.art
job_output_2.add_to_dataset = dts.%(submitter)s.%(stage_name)s.%(desc)s.art
job_output_2.dest = %(outdir_dts_tape)s/%(stage_name)s/%(desc)s/art

global.artRoot_dataset = dts.%(submitter)s.%(stage_name)s.%(desc)s.art

submit.dataset = cnf.%(submitter)s.%(stage_name)s.%(desc)s.fcl
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.postscript = samweb file-lineage parents `basename ${fname}` > parents.txt
job_setup.postscript_2 = echo ${fname} >> parents.txt

sam_consumer.schema = https
job_setup.prescript = export PATH=/cvmfs/larsoft-ib.opensciencegrid.org/mu2e/:${PATH}

job_setup.getconfig = True
job_setup.multifile = False
job_setup.setup_local = True

[stage_flateminusdigi_fcl]
global.stage_name = FlateMinusOnSpillDigi
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output.dest = https://dbdata0vm.fnal.gov:9443/mu2e_ucondb_prod/app/data/%(db_folder)s/
job_setup.source_3 = $CONDOR_DIR_INPUT/ucondb_auth.sh

executable.name = true
executable_2.name = gen_Digitize.sh
executable_2.arg_1 = FlateMinus
executable_2.arg_2 = %(release)s
executable_2.arg_3 = %(release_v_o)s
executable_2.arg_4 = %(release_v_o)s
executable_2.arg_5 = 1
executable_2.arg_6 = OnSpill
executable_2.arg_7 = perfect
executable_2.arg_8 = %(db_version)s

job_setup.postscript = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSOWNER/%(submitter)s/g" {} +
job_setup.postscript_2 = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSCONF/%(desc)s/g" {} +
job_setup.postscript_3 = find FlateMinus*[0-9]* -name "*.fcl*" -exec mv -t . {} +

job_setup.ifdh_art = False

[stage_flateminusdigi]
global.stage_name = FlateMinusOnSpill
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output_1.dest = %(logdir_bck)s/%(stage_name)sDigi/%(desc)s/tbz/

job_output_2.addoutput = dig.*.%(stage_name)sTrk.*art
job_output_2.add_to_dataset = dig.%(submitter)s.%(stage_name)sTrk.%(desc)s.art
job_output_2.dest = %(outdir_dig_tape)s/%(stage_name)sTrk/%(desc)s/art

job_output_3.addoutput = dig.*.%(stage_name)sUntriggered.*art
job_output_3.add_to_dataset = dig.%(submitter)s.%(stage_name)sUntriggered.%(desc)s.art
job_output_3.dest = %(outdir_dig_tape)s/%(stage_name)sUntriggered/%(desc)s/art

job_output_4.addoutput = dig.*.%(stage_name)sCalo.*art
job_output_4.add_to_dataset = dig.%(submitter)s.%(stage_name)sCalo.%(desc)s.art
job_output_4.dest = %(outdir_dig_tape)s/%(stage_name)sCalo/%(desc)s/art

job_output_5.addoutput = dig.*.%(stage_name)sSignal.*art
job_output_5.add_to_dataset = dig.%(submitter)s.%(stage_name)sSignal.%(desc)s.art
job_output_5.dest = %(outdir_dig_tape)s/%(stage_name)sSignal/%(desc)s/art

job_output_6.addoutput = dig.*.%(stage_name)sDiag.*art
job_output_6.add_to_dataset = dig.%(submitter)s.%(stage_name)sDiag.%(desc)s.art
job_output_6.dest = %(outdir_dig_tape)s/%(stage_name)sDiag/%(desc)s/art

global.artRoot_dataset = dig.%(submitter)s%(stage_name)sTrk.%(desc)s.art,dig.%(submitter)s.%(stage_name)sUntriggered.%(desc)s.art,dig.%(submitter)s.%(stage_name)sCalo.%(desc)s.art,dig.%(submitter)s.%(stage_name)sSignal.%(desc)s.art,dig.%(submitter)s.%(stage_name)sDiag.%(desc)s.art

sam_consumer.schema = https
job_setup.prescript = export PATH=/cvmfs/larsoft-ib.opensciencegrid.org/mu2e/:${PATH}

submit.dataset = cnf.%(submitter)s.%(stage_name)sDigi.%(desc)s.fcl
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.postscript = samweb file-lineage parents `basename ${fname}` > parents.txt
job_setup.postscript_2 = echo ${fname} >> parents.txt

job_setup.getconfig = True
job_setup.multifile = False
job_setup.setup_local = True

[stage_flateminusdigitriggered_reco_fcl]
global.stage_name = FlateMinusOnSpill1BBSignal
global.db_purpose = perfect
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output.dest = https://dbdata0vm.fnal.gov:9443/mu2e_ucondb_prod/app/data/%(db_folder)s/
job_setup.source_3 = $CONDOR_DIR_INPUT/ucondb_auth.sh

executable.name = true
executable_2.name = gen_Reco.sh
executable_2.arg_1 = %(stage_name)s
executable_2.arg_2 = %(release)s
executable_2.arg_3 = %(release_v_o)s
executable_2.arg_4 = %(release_v_o)s
executable_2.arg_5 = %(db_purpose)s
executable_2.arg_6 = %(db_version)s
executable_2.arg_7 = 1

job_setup.postscript = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSOWNER/%(submitter)s/g" {} +
job_setup.postscript_2 = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSCONF/%(desc)s/g" {} +
job_setup.postscript_3 = find FlateMinus*[0-9]* -name "*.fcl*" -exec mv -t . {} +

job_setup.ifdh_art = False

[stage_flateminusdigitriggered_reco]
global.stage_name = FlateMinusOnSpill1BBSignal
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s
job_output_1.dest = %(logdir_bck)s/%(stage_name)s/%(desc)s/tbz/

job_output_2.addoutput = mcs.*.%(stage_name)s.*art
job_output_2.add_to_dataset = mcs.%(submitter)s.%(stage_name)s.%(desc)s.art
job_output_2.dest = %(outdir_mcs_tape)s/%(stage_name)s/%(desc)s/art

global.artRoot_dataset = mcs.%(submitter)s.%(stage_name)s.%(desc)s.art

submit.dataset = cnf.%(submitter)s.%(stage_name)s.%(desc)s.fcl
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.postscript = samweb file-lineage parents `basename ${fname}` > parents.txt
job_setup.postscript_2 = echo ${fname} >> parents.txt

sam_consumer.schema = https
job_setup.prescript = export PATH=/cvmfs/larsoft-ib.opensciencegrid.org/mu2e/:${PATH}

job_setup.getconfig = True
job_setup.multifile = False
job_setup.setup_local = True

[stage_flateminusmix_startup_fcl]
global.stage_name = FlateMinusMix1BB
global.db_purpose = startup
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output.dest = https://dbdata0vm.fnal.gov:9443/mu2e_ucondb_prod/app/data/%(db_folder)s/
job_setup.source_3 = $CONDOR_DIR_INPUT/ucondb_auth.sh

executable.name = true
executable_2.name = gen_Mix.sh
executable_2.arg_1 = FlateMinus
executable_2.arg_2 = %(release)s
executable_2.arg_3 = %(release_v_i)s
executable_2.arg_4 = %(release_v_o)s
executable_2.arg_5 = %(release_v_o)s
executable_2.arg_6 = startup
executable_2.arg_7 = %(db_version)s
executable_2.arg_8 = 1BB

job_setup.postscript = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSOWNER/%(submitter)s/g" {} +
job_setup.postscript_2 = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSCONF/%(desc)s/g" {} +
job_setup.postscript_3 = find FlateMinus*[0-9]* -name "*.fcl*" -exec mv -t . {} +

job_setup.ifdh_art = False

[stage_flateminusmix_startup]
global.stage_name = FlateMinusMix1BB
global.db_purpose = startup
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s
job_output_1.dest = %(logdir_bck)s/%(stage_name)s/%(desc)s/tbz/

job_output_2.addoutput = dig.*.%(stage_name)sTrk.*art
job_output_2.add_to_dataset = dig.%(submitter)s.%(stage_name)sTrk.%(desc)s.art
job_output_2.dest = %(outdir_dig_tape)s/%(stage_name)sTrk/%(desc)s/art

job_output_3.addoutput = dig.*.%(stage_name)sUntriggered.*art
job_output_3.add_to_dataset = dig.%(submitter)s.%(stage_name)sUntriggered.%(desc)s.art
job_output_3.dest = %(outdir_dig_tape)s/%(stage_name)sUntriggered/%(desc)s/art

job_output_4.addoutput = dig.*.%(stage_name)sCalo.*art
job_output_4.add_to_dataset = dig.%(submitter)s.%(stage_name)sCalo.%(desc)s.art
job_output_4.dest = %(outdir_dig_tape)s/%(stage_name)sCalo/%(desc)s/art

job_output_5.addoutput = dig.*.%(stage_name)sSignal.*art
job_output_5.add_to_dataset = dig.%(submitter)s.%(stage_name)sSignal.%(desc)s.art
job_output_5.dest = %(outdir_dig_tape)s/%(stage_name)sSignal/%(desc)s/art

job_output_6.addoutput = dig.*.%(stage_name)sDiag.*art
job_output_6.add_to_dataset = dig.%(submitter)s.%(stage_name)sDiag.%(desc)s.art
job_output_6.dest = %(outdir_dig_tape)s/%(stage_name)sDiag/%(desc)s/art

global.artRoot_dataset = dig.%(submitter)s%(stage_name)sTrk.%(desc)s.art,dig.%(submitter)s.%(stage_name)sUntriggered.%(desc)s.art,dig.%(submitter)s.%(stage_name)sCalo.%(desc)s.art,dig.%(submitter)s.%(stage_name)sSignal.%(desc)s.art,dig.%(submitter)s.%(stage_name)sDiag.%(desc)s.art

submit.dataset = cnf.%(submitter)s.%(stage_name)s.%(desc)s.fcl
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.postscript = samweb file-lineage parents `basename ${fname}` > parents.txt
job_setup.postscript_2 = echo ${fname} >> parents.txt

sam_consumer.schema = https
job_setup.prescript = export PATH=/cvmfs/larsoft-ib.opensciencegrid.org/mu2e/:${PATH}

job_setup.getconfig = True
job_setup.multifile = False
job_setup.setup_local = True

[stage_flateminusmix_best_fcl]
global.stage_name = FlateMinusMix1BB
global.db_purpose = best
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output.dest = https://dbdata0vm.fnal.gov:9443/mu2e_ucondb_prod/app/data/%(db_folder)s/
job_setup.source_3 = $CONDOR_DIR_INPUT/ucondb_auth.sh

executable.name = true
executable_2.name = gen_Mix.sh
executable_2.arg_1 = FlateMinus
executable_2.arg_2 = %(release)s
executable_2.arg_3 = %(release_v_i)s
executable_2.arg_4 = %(release_v_o)s
executable_2.arg_5 = %(release_v_o)s
executable_2.arg_6 = %(db_purpose)s
executable_2.arg_7 = %(db_version)s
executable_2.arg_8 = 1BB

job_setup.postscript = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSOWNER/%(submitter)s/g" {} +
job_setup.postscript_2 = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSCONF/%(desc)s/g" {} +
job_setup.postscript_3 = find FlateMinus*[0-9]* -name "*.fcl*" -exec mv -t . {} +

job_setup.ifdh_art = False

[stage_flateminusmix_best]
global.stage_name = FlateMinusMix1BB
global.db_purpose = best
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s
job_output_1.dest = %(logdir_bck)s/%(stage_name)s/%(desc)s/tbz/

job_output_2.addoutput = dig.*.%(stage_name)sTrk.*art
job_output_2.add_to_dataset = dig.%(submitter)s.%(stage_name)sTrk.%(desc)s.art
job_output_2.dest = %(outdir_dig_tape)s/%(stage_name)sTrk/%(desc)s/art

job_output_3.addoutput = dig.*.%(stage_name)sUntriggered.*art
job_output_3.add_to_dataset = dig.%(submitter)s.%(stage_name)sUntriggered.%(desc)s.art
job_output_3.dest = %(outdir_dig_tape)s/%(stage_name)sUntriggered/%(desc)s/art

job_output_4.addoutput = dig.*.%(stage_name)sCalo.*art
job_output_4.add_to_dataset = dig.%(submitter)s.%(stage_name)sCalo.%(desc)s.art
job_output_4.dest = %(outdir_dig_tape)s/%(stage_name)sCalo/%(desc)s/art

job_output_5.addoutput = dig.*.%(stage_name)sSignal.*art
job_output_5.add_to_dataset = dig.%(submitter)s.%(stage_name)sSignal.%(desc)s.art
job_output_5.dest = %(outdir_dig_tape)s/%(stage_name)sSignal/%(desc)s/art

job_output_6.addoutput = dig.*.%(stage_name)sDiag.*art
job_output_6.add_to_dataset = dig.%(submitter)s.%(stage_name)sDiag.%(desc)s.art
job_output_6.dest = %(outdir_dig_tape)s/%(stage_name)sDiag/%(desc)s/art

global.artRoot_dataset = dig.%(submitter)s%(stage_name)sTrk.%(desc)s.art,dig.%(submitter)s.%(stage_name)sUntriggered.%(desc)s.art,dig.%(submitter)s.%(stage_name)sCalo.%(desc)s.art,dig.%(submitter)s.%(stage_name)sSignal.%(desc)s.art,dig.%(submitter)s.%(stage_name)sDiag.%(desc)s.art

submit.dataset = cnf.%(submitter)s.%(stage_name)s.%(desc)s.fcl
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.postscript = samweb file-lineage parents `basename ${fname}` > parents.txt
job_setup.postscript_2 = echo ${fname} >> parents.txt

sam_consumer.schema = https
job_setup.prescript = export PATH=/cvmfs/larsoft-ib.opensciencegrid.org/mu2e/:${PATH}

job_setup.getconfig = True
job_setup.multifile = False
job_setup.setup_local = True

[stage_flateminusmix_perfect_fcl]
global.stage_name = FlateMinusMix1BB
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output.dest = https://dbdata0vm.fnal.gov:9443/mu2e_ucondb_prod/app/data/%(db_folder)s/
job_setup.source_3 = $CONDOR_DIR_INPUT/ucondb_auth.sh

executable.name = true
executable_2.name = gen_Mix.sh
executable_2.arg_1 = FlateMinus
executable_2.arg_2 = %(release)s
executable_2.arg_3 = %(release_v_i)s
executable_2.arg_4 = %(release_v_o)s
executable_2.arg_5 = %(release_v_o)s
executable_2.arg_6 = %(db_purpose)s
executable_2.arg_7 = %(db_version)s
executable_2.arg_8 = 1BB

job_setup.postscript = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSOWNER/%(submitter)s/g" {} +
job_setup.postscript_2 = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSCONF/%(desc)s/g" {} +
job_setup.postscript_3 = find FlateMinus*[0-9]* -name "*.fcl*" -exec mv -t . {} +

job_setup.ifdh_art = False

[stage_flateminusmix_perfect]
global.stage_name = FlateMinusMix1BB
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s
job_output_1.dest = %(logdir_bck)s/%(stage_name)s/%(desc)s/tbz/

job_output_2.addoutput = dig.*.%(stage_name)sTrk.*art
job_output_2.add_to_dataset = dig.%(submitter)s.%(stage_name)sTrk.%(desc)s.art
job_output_2.dest = %(outdir_dig_tape)s/%(stage_name)sTrk/%(desc)s/art

job_output_3.addoutput = dig.*.%(stage_name)sUntriggered.*art
job_output_3.add_to_dataset = dig.%(submitter)s.%(stage_name)sUntriggered.%(desc)s.art
job_output_3.dest = %(outdir_dig_tape)s/%(stage_name)sUntriggered/%(desc)s/art

job_output_4.addoutput = dig.*.%(stage_name)sCalo.*art
job_output_4.add_to_dataset = dig.%(submitter)s.%(stage_name)sCalo.%(desc)s.art
job_output_4.dest = %(outdir_dig_tape)s/%(stage_name)sCalo/%(desc)s/art

job_output_5.addoutput = dig.*.%(stage_name)sSignal.*art
job_output_5.add_to_dataset = dig.%(submitter)s.%(stage_name)sSignal.%(desc)s.art
job_output_5.dest = %(outdir_dig_tape)s/%(stage_name)sSignal/%(desc)s/art

job_output_6.addoutput = dig.*.%(stage_name)sDiag.*art
job_output_6.add_to_dataset = dig.%(submitter)s.%(stage_name)sDiag.%(desc)s.art
job_output_6.dest = %(outdir_dig_tape)s/%(stage_name)sDiag/%(desc)s/art

global.artRoot_dataset = dig.%(submitter)s%(stage_name)sTrk.%(desc)s.art,dig.%(submitter)s.%(stage_name)sUntriggered.%(desc)s.art,dig.%(submitter)s.%(stage_name)sCalo.%(desc)s.art,dig.%(submitter)s.%(stage_name)sSignal.%(desc)s.art,dig.%(submitter)s.%(stage_name)sDiag.%(desc)s.art

submit.dataset = cnf.%(submitter)s.%(stage_name)s.%(desc)s.fcl
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.postscript = samweb file-lineage parents `basename ${fname}` > parents.txt
job_setup.postscript_2 = echo ${fname} >> parents.txt

sam_consumer.schema = https
job_setup.prescript = export PATH=/cvmfs/larsoft-ib.opensciencegrid.org/mu2e/:${PATH}

job_setup.getconfig = True
job_setup.multifile = False
job_setup.setup_local = True

[stage_flateminusmix1bbsignal_perfect_reco_fcl]
global.stage_name = FlateMinusMix1BBSignal
global.db_purpose = perfect
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output.dest = https://dbdata0vm.fnal.gov:9443/mu2e_ucondb_prod/app/data/%(db_folder)s/
job_setup.source_3 = $CONDOR_DIR_INPUT/ucondb_auth.sh

executable.name = true
executable_2.name = gen_Reco.sh
executable_2.arg_1 = %(stage_name)s
executable_2.arg_2 = %(release)s
executable_2.arg_3 = %(release_v_o)s
executable_2.arg_4 = %(release_v_o)s
executable_2.arg_5 = %(db_purpose)s
executable_2.arg_6 = %(db_version)s
executable_2.arg_7 = 1

job_setup.postscript = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSOWNER/%(submitter)s/g" {} +
job_setup.postscript_2 = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSCONF/%(desc)s/g" {} +
job_setup.postscript_3 = find FlateMinus*[0-9]* -name "*.fcl*" -exec mv -t . {} +

job_setup.ifdh_art = False

[stage_flateminusmix1bbsignal_perfect_reco]
global.stage_name = FlateMinusMix1BBSignal
global.db_purpose = perfect
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output_1.dest = %(logdir_bck)s/%(stage_name)s/%(desc)s/tbz/

job_output_2.addoutput = mcs.*.%(stage_name)s.*art
job_output_2.add_to_dataset = mcs.%(submitter)s.%(stage_name)s.%(desc)s.art
job_output_2.dest = %(outdir_mcs_tape)s/%(stage_name)s/%(desc)s/art

global.artRoot_dataset = mcs.%(submitter)s.%(stage_name)s.%(desc)s.art

submit.dataset = cnf.%(submitter)s.%(stage_name)s.%(desc)s.fcl
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.postscript = samweb file-lineage parents `basename ${fname}` > parents.txt
job_setup.postscript_2 = echo ${fname} >> parents.txt

sam_consumer.schema = https
job_setup.prescript = export PATH=/cvmfs/larsoft-ib.opensciencegrid.org/mu2e/:${PATH}

job_setup.getconfig = True
job_setup.multifile = False
job_setup.setup_local = True

[stage_flateminusmix1bbsignal_best_reco_fcl]
global.stage_name = FlateMinusMix1BBSignal
global.db_purpose = best
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output.dest = https://dbdata0vm.fnal.gov:9443/mu2e_ucondb_prod/app/data/%(db_folder)s/
job_setup.source_3 = $CONDOR_DIR_INPUT/ucondb_auth.sh

executable.name = true
executable_2.name = gen_Reco.sh
executable_2.arg_1 = %(stage_name)s
executable_2.arg_2 = %(release)s
executable_2.arg_3 = %(release_v_o)s
executable_2.arg_4 = %(release_v_o)s
executable_2.arg_5 = %(db_purpose)s
executable_2.arg_6 = %(db_version)s
executable_2.arg_7 = 1

job_setup.postscript = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSOWNER/%(submitter)s/g" {} +
job_setup.postscript_2 = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSCONF/%(desc)s/g" {} +
job_setup.postscript_3 = find FlateMinus*[0-9]* -name "*.fcl*" -exec mv -t . {} +

job_setup.ifdh_art = False

[stage_flateminusmix1bbsignal_best_reco]
global.stage_name = FlateMinusMix1BBSignal
global.db_purpose = best
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output_1.dest = %(logdir_bck)s/%(stage_name)s/%(desc)s/tbz/

job_output_2.addoutput = mcs.*.%(stage_name)s.*art
job_output_2.add_to_dataset = mcs.%(submitter)s.%(stage_name)s.%(desc)s.art
job_output_2.dest = %(outdir_mcs_tape)s/%(stage_name)s/%(desc)s/art

global.artRoot_dataset = mcs.%(submitter)s.%(stage_name)s.%(desc)s.art

submit.dataset = cnf.%(submitter)s.%(stage_name)s.%(desc)s.fcl
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.postscript = samweb file-lineage parents `basename ${fname}` > parents.txt
job_setup.postscript_2 = echo ${fname} >> parents.txt

sam_consumer.schema = https
job_setup.prescript = export PATH=/cvmfs/larsoft-ib.opensciencegrid.org/mu2e/:${PATH}

job_setup.getconfig = True
job_setup.multifile = False
job_setup.setup_local = True

[stage_flateminusmix1bbsignal_startup_reco_fcl]
global.stage_name = FlateMinusMix1BBSignal
global.db_purpose = startup
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output.dest = https://dbdata0vm.fnal.gov:9443/mu2e_ucondb_prod/app/data/%(db_folder)s/
job_setup.source_3 = $CONDOR_DIR_INPUT/ucondb_auth.sh

executable.name = true
executable_2.name = gen_Reco.sh
executable_2.arg_1 = %(stage_name)s
executable_2.arg_2 = %(release)s
executable_2.arg_3 = %(release_v_o)s
executable_2.arg_4 = %(release_v_o)s
executable_2.arg_5 = %(db_purpose)s
executable_2.arg_6 = %(db_version)s
executable_2.arg_7 = 1

job_setup.postscript = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSOWNER/%(submitter)s/g" {} +
job_setup.postscript_2 = find FlateMinus*[0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSCONF/%(desc)s/g" {} +
job_setup.postscript_3 = find FlateMinus*[0-9]* -name "*.fcl*" -exec mv -t . {} +

job_setup.ifdh_art = False

[stage_flateminusmix1bbsignal_startup_reco]
global.stage_name = FlateMinusMix1BBSignal
global.db_purpose = startup
global.desc = %(release)s%(release_v_o)s_%(db_purpose)s_%(db_version)s

job_output_1.dest = %(logdir_bck)s/%(stage_name)s/%(desc)s/tbz/

job_output_2.addoutput = mcs.*.%(stage_name)s.*art
job_output_2.add_to_dataset = mcs.%(submitter)s.%(stage_name)s.%(desc)s.art
job_output_2.dest = %(outdir_mcs_tape)s/%(stage_name)s/%(desc)s/art

global.artRoot_dataset = mcs.%(submitter)s.%(stage_name)s.%(desc)s.art

submit.dataset = cnf.%(submitter)s.%(stage_name)s.%(desc)s.fcl
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.postscript = samweb file-lineage parents `basename ${fname}` > parents.txt
job_setup.postscript_2 = echo ${fname} >> parents.txt

sam_consumer.schema = https
job_setup.prescript = export PATH=/cvmfs/larsoft-ib.opensciencegrid.org/mu2e/:${PATH}

job_setup.getconfig = True
job_setup.multifile = False
job_setup.setup_local = True