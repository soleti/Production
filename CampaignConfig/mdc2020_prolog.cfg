[global]
group = mu2e
subgroup = highpro
experiment = mu2e
wrapper = file:///${FIFE_UTILS_DIR}/libexec/fife_wrap
submitter = mu2e
outdir_sim = /pnfs/mu2e/scratch/datasets/phy-sim/sim/mu2e/
outdir_dts = /pnfs/mu2e/scratch/datasets/phy-sim/dts/mu2e/
logdir_bck = /pnfs/mu2e/persistent/datasets/phy-etc/bck/mu2e/
outdir_dig_tape = /pnfs/mu2e/tape/phy-sim/dig/mu2e/
outdir_dts_tape = /pnfs/mu2e/tape/phy-sim/dts/mu2e/
outdir_sim_tape = /pnfs/mu2e/tape/phy-sim/sim/mu2e/
outdir_mcs_tape = /pnfs/mu2e/tape/phy-sim/mcs/mu2e/
stage_name = override_me
artRoot_dataset = override_me
histRoot_dataset = override_me
override_dataset = override_me

[env_pass]
IFDH_DEBUG = 1
SAM_EXPERIMENT = %(experiment)s
OUTPUT_DATASET = bck.%(submitter)s.%(stage_name)s.%(desc)s.tbz
ARTROOT_DATASET = %(artRoot_dataset)s
HISTROOT_DATASET = %(histRoot_dataset)s
IFDH_CP_MAXRETRIES = 5
# IFDHC_CONFIG_VERSION = "v2_6_1 -q python27"
# IFDH_VERSION="v2_6_1 -q python27"

[submit]
debug = True
G = %(group)s
subgroup = highpro
e = SAM_EXPERIMENT
e_1 = IFDH_DEBUG
e_2 = POMS4_CAMPAIGN_NAME
e_3 = POMS4_CAMPAIGN_STAGE_NAME
resource-provides = usage_model=DEDICATED,OPPORTUNISTIC
generate-email-summary = True
expected-lifetime = 23h
memory = 2500MB
maxConcurrent = 10000
email-to = srsoleti@fnal.gov
l = '+SingularityImage=\"/cvmfs/singularity.opensciencegrid.org/fermilab/fnal-wn-sl7:latest\"'
append_condor_requirements='(TARGET.HAS_SINGULARITY=?=true)'
f = dropbox:///mu2e/app/home/mu2epro/db_fcl_test/ucondb_auth.sh

[job_setup]
debug = True
find_setups = False
source_1 = /cvmfs/mu2e.opensciencegrid.org/setupmu2e-art.sh
source_2 = /cvmfs/mu2e.opensciencegrid.org/Musings/SimJob/%(release)s%(release_v_o)s/setup.sh
setup_1 = -B ifdh_art v2_14_06 -q e20:prof
setup_2 = -B ifdhc_config
setup_3 = -B mu2etools
setup_4 = -B mu2efiletools
setup_5 = -B dhtools v1_19a
ifdh_art = True
postscript = [ -d 000 ] && find [0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSOWNER/%(submitter)s/g" {} +
postscript_2 = [ -d 000 ] && find [0-9]* -name "*.fcl" -exec sed -i "s/MU2EGRIDDSCONF/%(desc)s/g" {} +
postscript_3 = [ -d 000 ] && find [0-9]* -name "*.fcl*" -exec mv -t . {} +
postscript_4 = [ -f template.fcl ] && rm template.fcl
prescript_10 = muse status

[sam_consumer]
limit = 1
schema = xroot
appvers = %(desc)s
appfamily = art
appname = SimJob

[job_output]
addoutput = cnf.*.fcl
add_to_dataset = cnf.%(submitter)s.%(stage_name)s.%(desc)s.fcl
declare_metadata = True
metadata_extractor = json
add_location = True
add_metadata = file_format=fcl
# hash = 2
# parallel = 5
# hash_alg = sha256

[job_output_1]
addoutput = *.tbz
declare_metadata = False
metadata_extractor = printJsonSave.sh
add_location = True
add_metadata = file_format=tbz
add_to_dataset = bck.%(submitter)s.%(stage_name)s.%(desc)s.tbz
hash = 2
hash_alg = sha256

[job_output_2]
addoutput = *.art
declare_metadata = True
metadata_extractor = printJsonSave.sh
add_location = True
add_metadata = file_format=art
hash = 2
hash_alg = sha256

[job_output_3]
addoutput = *.art
declare_metadata = True
metadata_extractor = printJsonSave.sh
add_location = True
add_metadata = file_format=art
hash = 2
hash_alg = sha256

[stage_recovery]
submit.dataset=%(override_dataset)s

[executable]
name = loggedMu2e.sh

[executable_2]
name = true
arg_1 = --desc=%(stage_name)s
arg_2 = --dsconf=%(desc)s
arg_3 = --dsowner=%(submitter)s
